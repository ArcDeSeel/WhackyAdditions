#define FREEZE_ALL
	[terrain]
		terrain=Ai^Vaa
		[and]
			terrain=Wog^Vm
			y=21-41
		[/and]
	[/terrain]
	[terrain]
		terrain=Ai
		[and]
			terrain=Wog
			y=21-41
		[/and]
	[/terrain]
	[terrain]
		terrain=Ai^Es
		[and]
			terrain=Wwg
			y=21-41
		[/and]
	[/terrain]
	[terrain]
		terrain=Ai^Gvs
		[and]
			terrain=Ss
			y=21-41
		[/and]
	[/terrain]
#enddef
#define UNFREEZE_ALL
	[terrain]
		terrain=Wog^Vm
		[and]
			terrain=Ai^Vaa
			y=21-41
		[/and]
	[/terrain]
	[terrain]
		terrain=Wwg
		[and]
			terrain=Ai^Es
			y=21-41
		[/and]
	[/terrain]
	[terrain]
		terrain=Ss
		[and]
			terrain=Ai^Gvs
			y=21-41
		[/and]
	[/terrain]
	[terrain]
		terrain=Wog
		[and]
			terrain=Ai
			y=21-41
		[/and]
	[/terrain]
#enddef
#define FREEZE_ADJACENT
	[terrain]
		terrain=Ai^Vaa
		[and]
			terrain=Wog^Vm
			y=21-41
			[filter_adjacent_location]
				count=1-6
				include_borders=yes
				terrain=Ai,Ai^Es
				[or]
					x,y=32,4
				[/or]
			[/filter_adjacent_location]
		[/and]
	[/terrain]
	[terrain]
		terrain=Ai
		[and]
			terrain=Wog
			y=21-41
			[filter_adjacent_location]
				count=1-6
				include_borders=yes
				terrain=Ai,Ai^Es
				[or]
					x,y=32,4
				[/or]
			[/filter_adjacent_location]
		[/and]
	[/terrain]
	[terrain]
		terrain=Ai^Es
		[and]
			terrain=Wwg
			y=21-41
			[filter_adjacent_location]
				count=1-6
				include_borders=yes
				terrain=Ai,Ai^Es
				[or]
					x,y=32,4
				[/or]
			[/filter_adjacent_location]
		[/and]
	[/terrain]
	[terrain]
		terrain=Ai^Gvs
		[and]
			terrain=Ss
			y=21-41
			[filter_adjacent_location]
				count=1-6
				include_borders=yes
				terrain=Ai,Ai^Es
				[or]
					x,y=32,4
				[/or]
			[/filter_adjacent_location]
		[/and]
	[/terrain]
#enddef
#define UNFREEZE_ON_MOVEMENT
	[event]
		name=exit hex
		first_time_only=no
		[filter]
			[filter_adjacent_location]
				count=1-6
				terrain=Ai,Ai^Es
				y=21-41
			[/filter_adjacent_location]
		[/filter]
		[terrain]
			terrain=Wog^Vm
			[and]
				terrain=Ai^Vaa
				x,y=$x1,$y1
			[/and]
		[/terrain]
		[terrain]
			terrain=Wwg
			[and]
				terrain=Ai^Es
				x,y=$x1,$y1
			[/and]
		[/terrain]
		[terrain]
			terrain=Ss
			[and]
				terrain=Ai^Gvs
				x,y=$x1,$y1
			[/and]
		[/terrain]
		[terrain]
			terrain=Wog
			[and]
				terrain=Ai
				x,y=$x1,$y1
			[/and]
		[/terrain]
		[allow_undo]
		[/allow_undo]
	[/event]
#enddef
#define HIDDENLEADER SIDE TYPE X Y
		[unit]
			side={SIDE}
			type={TYPE}
			canrecruit=yes
			description="Ignore Me"
			x={X}
			y={Y}
		[/unit]
		[hide_unit]
			x,y={X},{Y}
		[/hide_unit]
#enddef
#define SCROLL_TO_SLOW X Y
		[scroll_to]
			x={X}
			y={Y}
		[/scroll_to]
#enddef
#define UNIT_FROM_RANDLIST SIDE TYPES X Y
	[set_variable]
		name=unit
		rand={TYPES}
	[/set_variable]
	[unit]
		type=$unit
		x,y={X},{Y}
		side={SIDE}
		random_gender=yes
		moves=0
	[/unit]
#enddef
#define HORIZONTAL_DELAYED_TRIGGER Y EVENTS
	# These areas should be village overlays. They will not function as villages except to attract AI.
	[event]
		name=moveto,recruit
		first_time_only=no
		[filter]
			y={Y}
		[/filter]
		[capture_village]
			x,y=$x1,$y1
		[/capture_village]
		[allow_undo]
		[/allow_undo]
	[/event]
	[event]
		name=side turn
		first_time_only=no
		[terrain]
			[and]
				y={Y}
				terrain=*^Vov
			[/and]
			layer=overlay
			terrain="^Es"
		[/terrain]
	[/event]
	[event]
		name=turn refresh
		first_time_only=no
		[terrain]
			[and]
				y={Y}
				terrain=*^Es
			[/and]
			layer=overlay
			terrain="^Vov"
		[/terrain]
	[/event]
	[event]
		name=enter_hex
		[filter]
			y={Y}
			side=1
		[/filter]
		[terrain]
			[and]
				y={Y}
			[/and]
			layer=overlay
			terrain="^"
		[/terrain]
		[redraw]
		[/redraw]
		[scroll_to]
			x=$x1
			y=$y1
			highlight=true
		[/scroll_to]
		{EVENTS}
	[/event]
#enddef
#define BASIC_LINESPAWN Y LANDLUA WATERLUA
	[fire_event]
		name=reload_lua
	[/fire_event]
	{VARIABLE_OP x value 0}
	{REPEAT 8 (
		{VARIABLE_OP x add 1}
		{LANDLUA}
		{UNIT_FROM_RANDLIST 1 ($landunit) $x {Y}}
	)}
	{VARIABLE_OP x add 1}
	{LANDLUA}
	{WATERLUA}
	{UNIT_FROM_RANDLIST 1 ($waterunit,$landunit) $x {Y}}
	{REPEAT 2 (
		{VARIABLE_OP x add 1}
		{WATERLUA}
		{UNIT_FROM_RANDLIST 1 ($waterunit) $x {Y}}
	)}
	{VARIABLE_OP x add 1}
	{LANDLUA}
	{WATERLUA}
	{UNIT_FROM_RANDLIST 1 ($waterunit,$landunit) $x {Y}}
	{REPEAT 8 (
		{VARIABLE_OP x add 1}
		{LANDLUA}
		{UNIT_FROM_RANDLIST 1 ($landunit) $x {Y}}
	)}
#enddef
#define VARIABLE_PHASE_LINESPAWN Y LANDLUA WATERLUA
	{BASIC_LINESPAWN {Y} {LANDLUA} {WATERLUA}}
#enddef
#define AT_TIME TIME FTO ACTION
	[event]
		name=side 1 turn refresh
		first_time_only={FTO}
		[store_time_of_day]
		[/store_time_of_day]
		[filter_condition]
			[variable]
				name=time_of_day.name
				equals={TIME}
			[/variable]
			[and]
				[variable]
					name=turn_number
					less_than_equal_to=100
				[/variable]
			[/and]
		[/filter_condition]
		{ACTION}
	[/event]
#enddef
#define DEFAULT_SPAWN NUMBER Y TIME LANDLUA WATERLUA WALL MESSAGES
	{HORIZONTAL_DELAYED_TRIGGER {Y} (
		{AT_TIME {TIME} yes (
			{AT_TIME {TIME} no (
				{VARIABLE_PHASE_LINESPAWN {Y} {LANDLUA} {WATERLUA}}
				{VARIABLE_OP wave[{NUMBER}].wave add 1}
			)}
			{WALL}
			{VARIABLE_OP phase value {NUMBER}}
			{RESET_WAVES}
		)}
		{MESSAGES}
	)}
#enddef
#define SETUNITLIST VARIABLE U1 U2 U3 U4 U5 U6 U7 U8 U9 U10 U11 U12 U13 U14 U15 U16
		[set_variables]
			name={VARIABLE}
			[value]
				units={U1}
			[/value]
			[value]
				units={U2}
			[/value]
			[value]
				units={U3}
			[/value]
			[value]
				units={U4}
			[/value]
			[value]
				units={U5}
			[/value]
			[value]
				units={U6}
			[/value]
			[value]
				units={U7}
			[/value]
			[value]
				units={U8}
			[/value]
			[value]
				units={U9}
			[/value]
			[value]
				units={U10}
			[/value]
			[value]
				units={U11}
			[/value]
			[value]
				units={U12}
			[/value]
			[value]
				units={U13}
			[/value]
			[value]
				units={U14}
			[/value]
			[value]
				units={U15}
			[/value]
			[value]
				units={U16}
			[/value]
		[/set_variables]
#enddef
#define INITIAL_LEADER_TRAITS SIDE NAME DESCRIPTION EFFECT
	[store_unit]
		[filter]
			canrecruit=yes
			side={SIDE}
		[/filter]
		variable=leader
	[/store_unit]
	{VARIABLE_OP leader.name value {NAME}}
	[unstore_unit]
		variable=leader
	[/unstore_unit]
	[object]
		[filter]
			canrecruit=yes
			side={SIDE}
		[/filter]
		[effect]
			apply_to=profile
			description={DESCRIPTION}
		[/effect]
		{EFFECT}
	[/object]
#enddef
#define LEADER_BONUS SIDE EFFECT
	[object]
		[filter]
			canrecruit=yes
			side={SIDE}
		[/filter]
		{EFFECT}
	[/object]
#enddef
#define LEADER_MESSAGE SIDE MESSAGE
	[message]
		canrecruit=yes
		side={SIDE}
		message={MESSAGE}
		scroll=no
	[/message]
#enddef
#define RAND_CAP_VILLAGE SIDES X Y
	{VARIABLE_OP vill rand {SIDES}}
	[capture_village]
		x,y={X},{Y}
		side=$vill
	[/capture_village]
#enddef
#define RESET_WAVES
	[set_variables]
		name=wave
		[value]
			wave=0
		[/value]
		[value]
			wave=0
		[/value]
		[value]
			wave=0
		[/value]
		[value]
			wave=0
		[/value]
		[value]
			wave=0
		[/value]
		[value]
			wave=0
		[/value]
		[value]
			wave=0
		[/value]
		[value]
			wave=0
		[/value]
		[value]
			wave=0
		[/value]
	[/set_variables]
#enddef
[multiplayer]
	id=Flight_Survival_5P
	name= _ "3p â€“ Flight Through Purgatory (Survival)"

		map_data="{~add-ons/WhackyAdditions/maps/fleeing_survival.map}"
	description= _ "You are the guardians of Purgatory, cut off from outside support. The inhabitants are rioting, and you do not have the strength to defeat them. You must contain the hordes of the half-damned for as long as possible, trying to prevent them from freeing each-other and destroying the Project."
	turns="-1"
	victory_when_enemies_defeated=no
	experience_modifier=70%
	{DEFAULT_SCHEDULE}
	{DEFAULT_MUSIC_PLAYLIST}

	[side]
   		side=1
   		controller=ai
            	allow_player=no
		team_name=crusaders
		gold=0
      		user_team_name= _ "Rioters"
		team_lock=yes
		color=red
		color_lock=true
		[ai]
			aggression=1
			caution=0
		[/ai]
		hidden=yes
            	no_leader=yes
		scroll_to_leader=no
		fog=yes
		shroud=yes
	[/side]

	[side]
		description=Human
   		side=2
   		canrecruit=yes
		enemy=1
   		controller=human
   		gold=100
		color=blue
		color_lock=true
      	team_name=reytahn,defenders
      	user_team_name= _ "Tyetikae"
		team_lock=yes
		fog=yes
		shroud=yes
   	[/side]

	[side]
		description=Human
   		side=3
   		canrecruit=yes
		enemy=1
   		controller=human 
		gold=100
      	team_name=baadsal,defenders
		color=green
		color_lock=true
      	user_team_name= _ "Reytahn"
		team_lock=yes
		fog=yes
		shroud=yes
   	[/side]

	[side]
		description=Human
	   	side=4
   		canrecruit=yes
		enemy=1
	   	controller=human 
		gold=100
      	team_name=tyetikae,defenders
		color=purple
		color_lock=yes
      	user_team_name= _ "Baadsal"
		team_lock=yes
		fog=yes
		shroud=yes
	[/side]

	[event]
		name=die
		first_time_only=no
		[filter]
			canrecruit=yes
			side=2
		[/filter]
		[message]
			speaker=unit
			message= _ "Alas...."
		[/message]
		[endlevel]
			result=defeat
		[/endlevel]
	[/event]
	[event]
		name=die
		first_time_only=no
		[filter]
			canrecruit=yes
			side=3
		[/filter]
		[message]
			speaker=unit
			message= _ "I failed...."
		[/message]
		[endlevel]
			result=defeat
		[/endlevel]
	[/event]
	[event]
		name=die
		first_time_only=no
		[filter]
			canrecruit=yes
			side=4
		[/filter]
		[message]
			speaker=unit
			message= _ "Curse them...."
		[/message]
		[endlevel]
			result=defeat
		[/endlevel]
	[/event]

	[event]
		name=side turn
		first_time_only=no
		[store_time_of_day]
		[/store_time_of_day]
	[/event]

	[event]
		name=reload_lua
		first_time_only=no
		[lua]
			code = <<
				function getrand (from, to)
					if string.len(from) > 0 then
						wesnoth.fire("set_variable", { name = to, rand = from })
						_G[to] = wesnoth.get_variable(to)
					else
						_G[to] = ""
					end
				end
				function pickcreature (set, l1, l2, l3, l1c, l2c, l3c, l4c, bonus, store)
					wave = wesnoth.get_variable("wave[" .. set .. "].wave")
					wesnoth.fire("set_variable", { name = "wave_number", value = wave })
					getrand(l1, "l1_base")
					getrand(l1c, "l1_comm")
					getrand(l2, "l2_base")
					getrand(l2c, "l2_comm")
					getrand(l3, "l3_base")
					getrand(l3c, "l3_comm")
					getrand(l4c, "l4_comm")
					getrand(bonus, "bonus_unit")
					getrand(l1_base .. "," .. l1_base .. "," .. l1_base .. "," .. l1_base .. "," .. l1_base .. "," .. l1_base .. "," .. l1_base .. "," .. l1_base .. "," .. l1_base .. "," .. l1_base .. "," .. l1_comm, "l1_stan")
					getrand(l1_base .. "," .. l1_base .. "," .. l1_base .. "," .. l1_base .. "," .. l1_base .. "," .. l2_comm, "l1_lead")
					getrand(l2_base .. "," .. l2_base .. "," .. l2_base .. "," .. l2_base .. "," .. l2_base .. "," .. l2_base .. "," .. l2_base .. "," .. l2_base .. "," .. l2_base .. "," .. l2_base .. "," .. l2_comm, "l2_stan")
					getrand(l2_base .. "," .. l2_base .. "," .. l2_base .. "," .. l2_base .. "," .. l2_base .. "," .. l3_comm, "l2_lead")
					getrand(l3_base .. "," .. l3_base .. "," .. l3_base .. "," .. l3_base .. "," .. l3_base .. "," .. l3_base .. "," .. l3_base .. "," .. l3_base .. "," .. l3_base .. "," .. l3_base .. "," .. l3_comm, "l3_stan")
					getrand(l3_base .. "," .. l3_base .. "," .. l3_base .. "," .. l3_base .. "," .. l3_base .. "," .. l4_comm, "l3_lead")
					list = ""
					if	wave == 0 	then 	list = l1_stan
					elseif	wave == 1 	then 	list = l1_lead
					elseif	wave == 2 	then 	list = l2_stan .. "," .. l1_lead .. "," .. l1_lead .. "," .. l1_lead .. "," .. l1_lead .. "," .. l1_lead
					elseif	wave == 3 	then 	list = l2_stan .. "," .. l1_lead .. "," .. l1_lead .. "," .. l1_lead .. "," .. l1_lead
					elseif	wave == 4 	then 	list = l2_stan .. "," .. l1_lead .. "," .. l1_lead .. "," .. l1_lead
					elseif	wave == 5 	then 	list = l2_stan .. "," .. l1_lead .. "," .. l1_lead
					elseif	wave == 6 	then 	list = l2_stan .. "," .. l1_lead
					elseif	wave == 7 	then 	list = l2_stan
					elseif	wave == 8 	then 	list = l2_lead
					elseif	wave == 9 	then 	list = l3_stan .. "," .. l2_lead .. "," .. l2_lead .. "," .. l2_lead .. "," .. l2_lead
					elseif	wave == 10 	then 	list = l3_stan .. "," .. l2_lead .. "," .. l2_lead .. "," .. l2_lead
					elseif	wave == 11 	then 	list = l3_stan .. "," .. l2_lead .. "," .. l2_lead
					elseif	wave == 12 	then 	list = l3_stan .. "," .. l2_lead
					elseif	wave == 13 	then 	list = l3_stan
					elseif	wave == 14 	then 	list = l3_lead
					else				list = l3_lead .. "," .. l3_lead .. "," .. l3_lead .. "," .. l3_lead .. "," .. l3_lead .. "," .. l3_lead .. "," .. l3_lead .. "," .. l3_lead .. "," .. l3_lead .. "," .. l3_lead .. "," .. bonus_unit
					end
					getrand(list, store)
				end
			>>
		[/lua]
	[/event]

	[event]
		name=prestart

		[unit]
			type=Elvish High Lord
			side=1
			canrecruit=yes
			x,y=11,165
			placement=map_overwrite
			generate_name=yes
		[/unit]

		{INITIAL_LEADER_TRAITS 2 "Reytahn" "Reytahn is the overseer in charge of the Countryside District of the Purgatory Project. Competent but not generous, ze has made the tactical choice to concentrate the limited power resources of the CRPP on zis own repulsion armor. Ze intends to use that advantage to its fullest extent." (
			[effect]
				apply_to=resistance
				[resistance]
					arcane=-15
					blade=-15
					cold=-15
					fire=-15
					impact=-15
					pierce=-15
				[/resistance]
			[/effect]
		)}
		{INITIAL_LEADER_TRAITS 3 "Baadsal" ("Baadsal is an inspector from the higher-ups. Officially, ze is completing a routine survey of the district, but ze is actually on the lookout for a saboteur suspected to be in the district. Outside telecommunications are down, so ze cannot escape the way he got in, but ze can send his molecular data to and from the various 'villages' in the area.

"+{SPECIAL_NOTES_TELEPORT}) (
			[effect]
				apply_to=new_ability
				[abilities]
					{ABILITY_TELEPORT}
				[/abilities]
			[/effect]
		)}
		{INITIAL_LEADER_TRAITS 4 "Tyetikae" ("Tyetikae intended to have a secret weapon when the detention center was breached. However, ze was double crossed. The device sent to zim by his handlers is a piece of junk barely able to slow the rioters down, much less bend them to zis own will. Ze intends to find his former employers and pay them back for their treachery, but first ze has to survive.

"+{SPECIAL_NOTES_SLOW}) (
			id=slows
			[effect]
				apply_to=attack
				[set_specials]
					mode=append
					{WEAPON_SPECIAL_SLOW}
				[/set_specials]
			[/effect]
		)}

		[objectives]
			[objective]
				description=_"Defeat all enemies. (The last wave comes on turn 100.)"
				condition=win
			[/objective]
			[objective]
				description=_"Prevent the rioters from getting to the next elongated castle."
				condition=win
				red=63
				green=255
				blue=127
			[/objective]
			[objective]
				description=_"Death of Reytahn,Baadsal, or Tyetikae."
				condition=lose
			[/objective]
			notes_string=Notes:
			[note]
				description=_"Each horizontal castle (DC) is filled with hordes of cursed enemies, locked in their encampments by a powerful enchantment. Escaped enemies will be able to unlock other enemies. There are near-infinite enemies in the DCs, but they can only escape at one time of day."
				red=255
				green=127
				blue=127
			[/note]
			[note]
				description=_"During the nighttime, the ice sheets in the Frozen District will rapidly expand. When any unit steps off of ice, the ice will melt."
				red=0
				green=127
				blue=255
				[show_if]
					[variable]
						name=phase
						greater_than_equal_to=5
					[/variable]
				[/show_if]
			[/note]
		[/objectives]

		#add hidden leaders so players whose leaders die can still play
		#{HIDDENLEADER 2 "Ruffian" 1 165}
		#{HIDDENLEADER 3 "Walking Corpse" 3 165}
		#{HIDDENLEADER 4 "Goblin Spearman" 5 165}

		[time_area]
			x=0-20
			y=41-62
			{UNDERGROUND}
		[/time_area]
		[time_area]
			x=0-20
			y=1-21
			{DAWN}
			{DUSK}
		[/time_area]
		[tunnel]
			[filter]
				side=2,3,4
			[/filter]
			[source]
				terrain=Gg^Ebn
			[/source]
			[target]
				terrain=Gg^Ebn
			[/target]
		[/tunnel]

		{RAND_CAP_VILLAGE (2,3,4) 3 143}
		{RAND_CAP_VILLAGE (2,3,4) 15 145}
		{RAND_CAP_VILLAGE (2,3,4) 7 147}
		{RAND_CAP_VILLAGE (2,3,4) 13 148}
		{RAND_CAP_VILLAGE (2,3,4) 2 149}
		{RAND_CAP_VILLAGE (2,3,4) 5 153}
		{RAND_CAP_VILLAGE (2,3,4) 13 154}
		{RAND_CAP_VILLAGE (2,3,4) 19 157}
		{RAND_CAP_VILLAGE (2,3,4) 14 158}
		{RAND_CAP_VILLAGE (2,3,4) 4 159}

		{RAND_CAP_VILLAGE (2,3,4) 10 123}
		{RAND_CAP_VILLAGE (2,3,4) 19 123}
		{RAND_CAP_VILLAGE (2,3,4) 15 128}
		{RAND_CAP_VILLAGE (2,3,4) 7 129}
		{RAND_CAP_VILLAGE (2,3,4) 1 129}
		{RAND_CAP_VILLAGE (2,3,4) 12 131}
		{RAND_CAP_VILLAGE (2,3,4) 19 134}
		{RAND_CAP_VILLAGE (2,3,4) 5 135}
		{RAND_CAP_VILLAGE (2,3,4) 2 138}
		{RAND_CAP_VILLAGE (2,3,4) 16 138}

		{FREEZE_ALL}


		{VARIABLE_OP phase value -1}
		{RESET_WAVES}
		{DEFAULT_SPAWN 1 141 "Morning" (
				[lua]
					code = <<
						pickcreature("1", "Elvish Fighter,Elvish Fighter,Elvish Archer,Elvish Archer,Elvish Shaman,Elvish Scout,Wose", "Elvish Captain,Elvish Hero,Elvish Marksman,Elvish Ranger,Elvish Sorceress,Elvish Druid,Elvish Rider,Elder Wose", "Elvish Marshal,Elvish Champion,Elvish Sharpshooter,Elvish Avenger,Elvish Enchantress,Elvish Shyde,Elvish Outrider,Ancient Wose", "", "Elvish Lord", "Elvish High Lord", "Elvish High Lord", "Elvish High Lord,Elvish Sylph", "landunit")
					>>
				[/lua]
			) (
				[lua]
					code = <<
						pickcreature("1","Merman Fighter,Merman Hunter,Mermaid Initiate", "Merman Warrior,Merman Warrior,Merman Spearman,Merman Netcaster,Mermaid Enchantress,Mermaid Priestess", "Merman Triton,Merman Hoplite,Merman Javelineer,Merman Entangler,Mermaid Siren,Mermaid Diviner", "", "", "", "", "", "waterunit")
					>>
				[/lua]
			) (
			{EARTHQUAKE (
			[terrain]
				[and]
					y=121
				[/and]
				layer=overlay
				terrain="^Vov"
			[/terrain]
			[remove_shroud]
				side=2,3,4
				x=0-21
				y=102-131
			[/remove_shroud]
			[lift_fog]
				side=2,3,4
				x=0-21
				y=102-131
			[/lift_fog]
			{SCROLL_TO_SLOW 10 112}
			[delay]
				time=500
			[/delay]
			)}
			[delay]
				time=500
			[/delay]
			{LEADER_MESSAGE 4 "There's nobody here."}
			{LEADER_MESSAGE 2 "We'd better take advantage of those abandoned 'villages'."}
			{LEADER_MESSAGE 3 "I'm on it."}
			{SCROLL_TO_SLOW 10 112}
			{RAND_CAP_VILLAGE (2,3,4) 4 103}
			[delay]
				time=100
			[/delay]
			{RAND_CAP_VILLAGE (2,3,4) 7 106}
			[delay]
				time=100
			[/delay]
			{RAND_CAP_VILLAGE (2,3,4) 18 103}
			[delay]
				time=100
			[/delay]
			{RAND_CAP_VILLAGE (2,3,4) 15 107}
			[delay]
				time=100
			[/delay]
			{RAND_CAP_VILLAGE (2,3,4) 7 110}
			[delay]
				time=100
			[/delay]
			{RAND_CAP_VILLAGE (2,3,4) 20 109}
			[delay]
				time=100
			[/delay]
			{RAND_CAP_VILLAGE (2,3,4) 13 112}
			[delay]
				time=100
			[/delay]
			{RAND_CAP_VILLAGE (2,3,4) 1 113}
			[delay]
				time=100
			[/delay]
			{RAND_CAP_VILLAGE (2,3,4) 16 116}
			[delay]
				time=100
			[/delay]
			{RAND_CAP_VILLAGE (2,3,4) 7 117}
			[delay]
				time=100
			[/delay]
			{LEADER_MESSAGE 2 "We'd better try to prevent them from getting to the Marsh District DC."}
			[show_objectives]
			[/show_objectives]
		) (
			{LEADER_MESSAGE 4 "They've gotten to the other DC."}
			{LEADER_MESSAGE 3 "By next afternoon they'll have gained access to the Marsh District, and in another day they'll have reinforcements pouring out of that castle."}
			{LEADER_MESSAGE 2 "Maybe we'll have reinforcements from the Marsh District as well, but we can't count on it."}
		)}
		{HORIZONTAL_DELAYED_TRIGGER 121 (
			{AT_TIME "Dusk" yes (
				{AT_TIME "Dusk" no (
					{VARIABLE_OP x value 0}
					{REPEAT 8 (
						{VARIABLE_OP x add 1}
						[lua]
							code = <<
								pickcreature("2", "Saurian Skirmisher,Saurian Skirmisher,Saurian Augur", "Saurian Ambusher,Saurian Ambusher,Saurian Ambusher,Saurian Ambusher,Saurian Oracle,Saurian Soothsayer", "Saurian Flanker,Saurian Flanker,Saurian Flanker,Saurian Flanker,Saurian Flanker,Saurian Flanker,Saurian Flanker,Saurian Flanker,Saurian Oracle,Saurian Soothsayer", "", "", "", "", "", "landunit")
							>>
						[/lua]
						{UNIT_FROM_RANDLIST 1 ($landunit) $x 121}
					)}
					{VARIABLE_OP x add 1}
					[lua]
						code = <<
							pickcreature("2", "Saurian Skirmisher,Saurian Skirmisher,Saurian Augur", "Saurian Ambusher,Saurian Ambusher,Saurian Ambusher,Saurian Ambusher,Saurian Oracle,Saurian Soothsayer", "Saurian Flanker,Saurian Flanker,Saurian Flanker,Saurian Flanker,Saurian Flanker,Saurian Flanker,Saurian Flanker,Saurian Flanker,Saurian Oracle,Saurian Soothsayer", "", "", "", "", "", "landunit")
						>>
					[/lua]
					[lua]
						code = <<
							pickcreature("2", "Naga Fighter", "Naga Warrior", "Naga Myrmidon", "", "", "", "", "", "waterunit")
						>>
					[/lua]
					{UNIT_FROM_RANDLIST 1 ($landunit,$waterunit) $x 121}
					{REPEAT 2 (
						{VARIABLE_OP x add 1}
						[lua]
							code = <<
								pickcreature("2", "Naga Fighter", "Naga Warrior", "Naga Myrmidon", "", "", "", "", "", "waterunit")
							>>
						[/lua]
						{UNIT_FROM_RANDLIST 1 ($waterunit) $x 121}
					)}
					{VARIABLE_OP x add 1}
					[lua]
						code = <<
							pickcreature("2", "Naga Fighter", "Naga Warrior", "Naga Myrmidon", "", "", "", "", "", "waterunit")
						>>
					[/lua]
					[lua]
						code = <<
							pickcreature("2", "Footpad,Thief,Thug,Poacher", "Outlaw,Rogue,Bandit,Trapper", "Fugitive,Fugitive,Assassin,Assassin,Highwayman,Highwayman,Huntsman,Ranger", "", "", "", "", "", "landunit")
						>>
					[/lua]
					{UNIT_FROM_RANDLIST 1 ($landunit,$waterunit) $x 121}
					{REPEAT 8 (
						{VARIABLE_OP x add 1}
						[lua]
							code = <<
								pickcreature("2", "Footpad,Thief,Thug,Poacher", "Outlaw,Rogue,Bandit,Trapper", "Fugitive,Fugitive,Assassin,Assassin,Highwayman,Highwayman,Huntsman,Ranger", "", "", "", "", "", "landunit")
							>>
						[/lua]
						{UNIT_FROM_RANDLIST 1 ($landunit) $x 121}
					)}
					{VARIABLE_OP wave[2].wave add 1}
				)}
				{EARTHQUAKE (
				[terrain]
					[and]
						y=101
					[/and]
					layer=overlay
					terrain="^Vov"
				[/terrain]
				[remove_shroud]
					side=2,3,4
					x=0-21
					y=82-101
				[/remove_shroud]
				[lift_fog]
					side=2,3,4
					x=0-21
					y=82-101
				[/lift_fog]
				{SCROLL_TO_SLOW 10 92}
				[delay]
					time=250
				[/delay]
				)}
				[delay]
					time=250
				[/delay]
				{LEADER_MESSAGE 4 "Somebody really liked symmetry"}
				{RAND_CAP_VILLAGE (2,3,4) 15 84}
				{RAND_CAP_VILLAGE (2,3,4) 4 84}
				{RAND_CAP_VILLAGE (2,3,4) 17 87}
				{RAND_CAP_VILLAGE (2,3,4) 10 87}
				{RAND_CAP_VILLAGE (2,3,4) 3 91}
				{RAND_CAP_VILLAGE (2,3,4) 18 91}
				{RAND_CAP_VILLAGE (2,3,4) 11 95}
				{RAND_CAP_VILLAGE (2,3,4) 4 95}
				{RAND_CAP_VILLAGE (2,3,4) 17 98}
				{RAND_CAP_VILLAGE (2,3,4) 6 98}
				[delay]
					time=500
				[/delay]
				{LEADER_MESSAGE 2 "We still need to slow them down."}
				[show_objectives]
				[/show_objectives]
				{RESET_WAVES}
			)}
			{LEADER_MESSAGE 2 "Dang!"}
			{LEADER_MESSAGE 4 "I assume we repeat the manuever?"}
			{LEADER_MESSAGE 3 "I doubt the Mountain District is in any better shape."}
		)}
		{DEFAULT_SPAWN 3 101 "First Watch" (
				[lua]
					code = <<
						pickcreature("3", "Dwarvish Fighter,Dwarvish Thunderer,Dwarvish Guardsman,Dwarvish Ulfserker,Dwarvish Scout,Gryphon Rider", "Dwarvish Steelclad,Dwarvish Thunderguard,Dwarvish Stalwart,Dwarvish Pathfinder,Dwarvish Berserker,Gryphon Master", "Dwarvish Lord,Dwarvish Dragonguard,Dwarvish Sentinel,Dwarvish Explorer,Dwarvish Berserker,Gryphon Master", "", "Dwarvish Runesmith", "Dwarvish Runemaster", "Dwarvish Arcanister", "Dwarvish Arcanister", "landunit")
					>>
				[/lua]
			) (
				[lua]
					code = <<
						pickcreature("3","Wolf,Wolf,Cuttle Fish", "Cuttle Fish", "Cuttle Fish", "", "", "", "", "", "waterunit")
					>>
				[/lua]
			) (
			{EARTHQUAKE (
			[terrain]
				[and]
					y=81
				[/and]
				layer=overlay
				terrain="^Vov"
			[/terrain]
			[remove_shroud]
				side=2,3,4
				x=0-21
				y=62-81
			[/remove_shroud]
			[lift_fog]
				side=2,3,4
				x=0-21
				y=62-81
			[/lift_fog]
			{SCROLL_TO_SLOW 10 72}
			[delay]
				time=125
			[/delay]
			)}
			[delay]
				time=125
			[/delay]
			{RAND_CAP_VILLAGE (2,3,4) 12 63}
			{RAND_CAP_VILLAGE (2,3,4) 3 66}
			{RAND_CAP_VILLAGE (2,3,4) 19 66}
			{RAND_CAP_VILLAGE (2,3,4) 8 67}
			{RAND_CAP_VILLAGE (2,3,4) 13 69}
			{RAND_CAP_VILLAGE (2,3,4) 7 72}
			{RAND_CAP_VILLAGE (2,3,4) 18 73}
			{RAND_CAP_VILLAGE (2,3,4) 1 75}
			{RAND_CAP_VILLAGE (2,3,4) 13 77}
			{RAND_CAP_VILLAGE (2,3,4) 8 77}
			[delay]
				time=250
			[/delay]
			[show_objectives]
			[/show_objectives]
		) (
			{LEADER_MESSAGE 4 "They've got another one."}
		)}
		{DEFAULT_SPAWN 4 81 "Dawn" (
				[lua]
					code = <<
						pickcreature("4", "Drake Burner,Drake Burner,Drake Clasher,Drake Clasher,Drake Fighter,Drake Fighter,Drake Glider", "Drake Flare,Fire Drake,Drake Thrasher,Drake Arbiter,Drake Warrior,Drake Warrior,Sky Drake", "Drake Flameheart,Inferno Drake,Drake Enforcer,Drake Warden,Drake Blademaster,Drake Blademaster,Hurricane Drake", "", "", "", "Armageddon Drake", "Fire Dragon", "landunit")
					>>
				[/lua]
			) (
				[lua]
					code = <<
						pickcreature("4","Mudcrawler,Mudcrawler,Water Serpent", "Water Serpent", "Water Serpent", "", "", "", "", "", "waterunit")
					>>
				[/lua]
			) (
			{EARTHQUAKE (
			[terrain]
				[and]
					y=61
				[/and]
				layer=overlay
				terrain="^Vov"
			[/terrain]
			[remove_shroud]
				side=2,3,4
				x=0-21
				y=42-61
			[/remove_shroud]
			[lift_fog]
				side=2,3,4
				x=0-21
				y=42-61
			[/lift_fog]
			{SCROLL_TO_SLOW 10 52}
			[delay]
				time=62
			[/delay]
			)}
			[delay]
				time=62
			[/delay]
			{RAND_CAP_VILLAGE (2,3,4) 4 43}
			{RAND_CAP_VILLAGE (2,3,4) 19 44}
			{RAND_CAP_VILLAGE (2,3,4) 10 44}
			{RAND_CAP_VILLAGE (2,3,4) 14 45}
			{RAND_CAP_VILLAGE (2,3,4) 4 48}
			{RAND_CAP_VILLAGE (2,3,4) 13 51}
			{RAND_CAP_VILLAGE (2,3,4) 4 55}
			{RAND_CAP_VILLAGE (2,3,4) 20 55}
			{RAND_CAP_VILLAGE (2,3,4) 17 57}
			{RAND_CAP_VILLAGE (2,3,4) 10 59}
			[delay]
				time=125
			[/delay]
			[show_objectives]
			[/show_objectives]
		) (
			{LEADER_MESSAGE 2 "We've lost the desert district."}
		)}
		{HORIZONTAL_DELAYED_TRIGGER 61 (
			{AT_TIME "Afternoon" yes (
				{AT_TIME "Afternoon" no (
					{VARIABLE_OP x value 0}
					{REPEAT 8 (
						{VARIABLE_OP x add 1}
						[lua]
							code = <<
								pickcreature("5", "Dark Adept,Skeleton,Skeleton Archer,Ghost,Ghoul,Walking Corpse", "Dark Sorcerer,Dark Sorcerer,Revenant,Deathblade,Bone Shooter,Bone Shooter,Wraith,Shadow,Necrophage,Necrophage,Soulless,Soulless", "Lich,Necromancer,Draug,Draug,Banebow,Banebow,Spectre,Nightgaunt,Ghast,Ghast", "", "", "Death Knight", "", "Ancient Lich,Bone Dragon,Ancient Lich,Bone Dragon", "landunit")
							>>
						[/lua]
						{UNIT_FROM_RANDLIST 1 ($landunit) $x 61}
					)}
					{VARIABLE_OP x add 1}
					[lua]
						code = <<
							pickcreature("5", "Dark Adept,Skeleton,Skeleton Archer,Ghost,Ghoul,Walking Corpse", "Dark Sorcerer,Dark Sorcerer,Revenant,Deathblade,Bone Shooter,Bone Shooter,Wraith,Shadow,Necrophage,Necrophage,Soulless,Soulless", "Lich,Necromancer,Draug,Draug,Banebow,Banebow,Spectre,Nightgaunt,Ghast,Ghast", "", "", "Death Knight", "", "Ancient Lich,Bone Dragon,Ancient Lich,Bone Dragon", "landunit")
						>>
					[/lua]
					[lua]
						code = <<
							pickcreature("5", "Tentacle ofthe Deep", "Tentacle ofthe Deep", "Tentacle ofthe Deep", "", "", "", "", "", "waterunit")
						>>
					[/lua]
					{UNIT_FROM_RANDLIST 1 ($waterunit,$landunit) $x 61}
					{REPEAT 2 (
						{VARIABLE_OP x add 1}
						[lua]
							code = <<
								pickcreature("5", "Tentacle ofthe Deep", "Tentacle ofthe Deep", "Tentacle ofthe Deep", "", "", "", "", "", "waterunit")
							>>
						[/lua]
						{UNIT_FROM_RANDLIST 1 ($waterunit) $x 61}
					)}
					{VARIABLE_OP x add 1}
					[lua]
						code = <<
							pickcreature("5", "Tentacle ofthe Deep", "Tentacle ofthe Deep", "Tentacle ofthe Deep", "", "", "", "", "", "waterunit")
						>>
					[/lua]
					[lua]
						code = <<
							pickcreature("5", "Troll Whelp", "Troll,Troll,Troll Rocklobber", "Troll Warrior,Troll Warrior,Troll Warrior,Troll Rocklobber", "", "", "Troll Shaman,Troll Hero", "Troll Shaman,Troll Hero,Great Troll", "Troll Shaman,Troll Hero,Great Troll", "landunit")
						>>
					[/lua]
					{UNIT_FROM_RANDLIST 1 ($waterunit,$landunit) $x 61}
					{REPEAT 8 (
						{VARIABLE_OP x add 1}
						[lua]
							code = <<
								pickcreature("5", "Troll Whelp", "Troll,Troll,Troll Rocklobber", "Troll Warrior,Troll Warrior,Troll Warrior,Troll Rocklobber", "", "", "Troll Shaman,Troll Hero", "Troll Shaman,Troll Hero,Great Troll", "Troll Shaman,Troll Hero,Great Troll", "landunit")
							>>
						[/lua]
						{UNIT_FROM_RANDLIST 1 ($landunit) $x 61}
					)}
					{VARIABLE_OP wave[5].wave add 1}
				)}
				{EARTHQUAKE (
				[terrain]
					[and]
						y=41
					[/and]
					layer=overlay
					terrain="^Vov"
				[/terrain]
				[remove_shroud]
					side=2,3,4
					x=0-21
					y=22-41
				[/remove_shroud]
				[lift_fog]
					side=2,3,4
					x=0-21
					y=22-41
				[/lift_fog]
				{SCROLL_TO_SLOW 10 52}
				[delay]
					time=31
				[/delay]
				)}
				[delay]
					time=31
				[/delay]
				{RAND_CAP_VILLAGE (2,3,4) 18 24}
				{RAND_CAP_VILLAGE (2,3,4) 12 26}
				{RAND_CAP_VILLAGE (2,3,4) 1 29}
				{RAND_CAP_VILLAGE (2,3,4) 9 30}
				{RAND_CAP_VILLAGE (2,3,4) 5 31}
				{RAND_CAP_VILLAGE (2,3,4) 19 31}
				{RAND_CAP_VILLAGE (2,3,4) 15 36}
				{RAND_CAP_VILLAGE (2,3,4) 1 37}
				{RAND_CAP_VILLAGE (2,3,4) 12 38}
				{RAND_CAP_VILLAGE (2,3,4) 19 39}
				[delay]
					time=62
				[/delay]
				[show_objectives]
				[/show_objectives]
				{VARIABLE_OP phase add 1}
				{RESET_WAVES}
				{LEADER_MESSAGE 3 "Only three DCs are untouched in the whole project."}
			)}
			{LEADER_MESSAGE 2 "Dang!"}
			{LEADER_MESSAGE 4 "I assume we repeat the manuever?"}
			{LEADER_MESSAGE 3 "I doubt the Mountain District is in any better shape."}
		)}
		{HORIZONTAL_DELAYED_TRIGGER 41 (
			{AT_TIME "Dusk" yes (
				{AT_TIME "Dusk" no (
					{VARIABLE_OP x value 0}
					{REPEAT 2 (
						{VARIABLE_OP x add 1}
						[lua]
							code = <<
								pickcreature("6","Orcish Leader,Goblin Spearman,Goblin Spearman,Goblin Spearman,Goblin Spearman", "Orcish Ruler,Goblin Rouser,Goblin Spearman,Goblin Spearman,Goblin Spearman", "Orcish Soverein,Goblin Rouser,Goblin Impaler,Goblin Spearman,Goblin Spearman", "", "", "", "", "", "landunit")
							>>
						[/lua]
						{UNIT_FROM_RANDLIST 1 ($landunit) $x 40}
						[lua]
							code = <<
								pickcreature("6","Orcish Leader,Goblin Spearman,Goblin Spearman,Goblin Spearman,Goblin Spearman", "Orcish Ruler,Goblin Rouser,Goblin Spearman,Goblin Spearman,Goblin Spearman", "Orcish Soverein,Goblin Rouser,Goblin Impaler,Goblin Spearman,Goblin Spearman", "", "", "", "", "", "landunit")
							>>
						[/lua]
						{UNIT_FROM_RANDLIST 1 ($landunit) $x 41}
						[lua]
							code = <<
								pickcreature("6","Orcish Leader,Goblin Spearman,Goblin Spearman,Goblin Spearman,Goblin Spearman", "Orcish Ruler,Goblin Rouser,Goblin Spearman,Goblin Spearman,Goblin Spearman", "Orcish Soverein,Goblin Rouser,Goblin Impaler,Goblin Spearman,Goblin Spearman", "", "", "", "", "", "landunit")
							>>
						[/lua]
						{UNIT_FROM_RANDLIST 1 ($landunit) $x 42}
					)}
					{VARIABLE_OP x add 1}
					[lua]
						code = <<
							pickcreature("6","Orcish Leader,Goblin Spearman,Goblin Spearman,Goblin Spearman,Goblin Spearman", "Orcish Ruler,Goblin Rouser,Goblin Spearman,Goblin Spearman,Goblin Spearman", "Orcish Soverein,Goblin Rouser,Goblin Impaler,Goblin Spearman,Goblin Spearman", "", "", "", "", "", "landunit")
						>>
					[/lua]
					[lua]
						code = <<
							pickcreature("6","Merman Fighter,Merman Hunter,Mermaid Initiate", "Merman Warrior,Merman Warrior,Merman Spearman,Merman Netcaster,Mermaid Enchantress,Mermaid Priestess", "Merman Triton,Merman Hoplite,Merman Javelineer,Merman Entangler,Mermaid Siren,Mermaid Diviner", "", "", "", "", "", "waterunit")
						>>
					[/lua]
					{UNIT_FROM_RANDLIST 1 ($waterunit, $landunit) $x 41}
					{REPEAT 4 (
						{VARIABLE_OP x add 1}
						[lua]
							code = <<
								pickcreature("6","Merman Fighter,Merman Hunter,Mermaid Initiate", "Merman Warrior,Merman Warrior,Merman Spearman,Merman Netcaster,Mermaid Enchantress,Mermaid Priestess", "Merman Triton,Merman Hoplite,Merman Javelineer,Merman Entangler,Mermaid Siren,Mermaid Diviner", "", "", "", "", "", "waterunit")
							>>
						[/lua]
						{UNIT_FROM_RANDLIST 1 ($waterunit) $x 41}
					)}
					{VARIABLE_OP x add 1}
					[lua]
						code = <<
							pickcreature("6","Merman Fighter,Merman Hunter,Mermaid Initiate", "Merman Warrior,Merman Warrior,Merman Spearman,Merman Netcaster,Mermaid Enchantress,Mermaid Priestess", "Merman Triton,Merman Hoplite,Merman Javelineer,Merman Entangler,Mermaid Siren,Mermaid Diviner", "", "", "", "", "", "waterunit")
						>>
					[/lua]
					[lua]
						code = <<
							pickcreature("6","Orcish Grunt,Orcish Archer,Orcish Assassin", "Orcish Warrior,Orcish Crossbowman,Orcish Slayer", "Orcish Warlord,Orcish Slurbow,Orcish Nightblade", "Orcish Leader", "Orcish Ruler", "Orcish Sovereign", "", "", "landunit")
						>>
					[/lua]
					{UNIT_FROM_RANDLIST 1 ($waterunit, $landunit) $x 41}
					{REPEAT 4 (
						{VARIABLE_OP x add 1}
						[lua]
							code = <<
								pickcreature("6","Orcish Grunt,Orcish Archer,Orcish Assassin", "Orcish Warrior,Orcish Crossbowman,Orcish Slayer", "Orcish Warlord,Orcish Slurbow,Orcish Nightblade", "Orcish Leader", "Orcish Ruler", "Orcish Sovereign", "", "", "landunit")
							>>
						[/lua]
						{UNIT_FROM_RANDLIST 1 ($landunit) $x 41}
					)}
					{VARIABLE_OP x add 1}
					[lua]
						code = <<
							pickcreature("6","Orcish Grunt,Orcish Archer,Orcish Assassin", "Orcish Warrior,Orcish Crossbowman,Orcish Slayer", "Orcish Warlord,Orcish Slurbow,Orcish Nightblade", "Orcish Leader", "Orcish Ruler", "Orcish Sovereign", "", "", "landunit")
						>>
					[/lua]
					[lua]
						code = <<
							pickcreature("6", "Naga Fighter", "Naga Warrior", "Naga Myrmidon", "", "", "", "", "Sea Serpent", "waterunit")
						>>
					[/lua]
					{UNIT_FROM_RANDLIST 1 ($waterunit, $landunit) $x 41}
					{REPEAT 4 (
						{VARIABLE_OP x add 1}
						[lua]
							code = <<
								pickcreature("6", "Naga Fighter", "Naga Warrior", "Naga Myrmidon", "", "", "", "", "Sea Serpent", "waterunit")
							>>
						[/lua]
						{UNIT_FROM_RANDLIST 1 ($waterunit) $x 41}
					)}	
					{VARIABLE_OP x add 1}
					[lua]
						code = <<
							pickcreature("6", "Naga Fighter", "Naga Warrior", "Naga Myrmidon", "", "", "", "", "Sea Serpent", "waterunit")
						>>
					[/lua]
					[lua]
						code = <<
							pickcreature("6", "Wolf Rider", "Goblin Knight,Goblin Knight,Goblin Pillager", "Direwolf Rider,Direwolf Rider,Direwolf Rider,Goblin Pillager", "", "", "", "", "", "waterunit")
						>>
					[/lua]
					{UNIT_FROM_RANDLIST 1 ($waterunit, $landunit) $x 41}
					{REPEAT 2 (
						{VARIABLE_OP x add 1}
						[lua]
							code = <<
								pickcreature("6", "Wolf Rider", "Goblin Knight,Goblin Knight,Goblin Pillager", "Direwolf Rider,Direwolf Rider,Direwolf Rider,Goblin Pillager", "", "", "", "", "", "waterunit")
							>>
						[/lua]
						{UNIT_FROM_RANDLIST 1 ($landunit) $x 41}
					)}
					{VARIABLE_OP wave[6].wave add 1}
				)}
				{EARTHQUAKE (
				[terrain]
					[and]
						y=21
					[/and]
					layer=overlay
					terrain="^Vov"
				[/terrain]
				[remove_shroud]
					side=2,3,4
					x=0-21
					y=0-21
				[/remove_shroud]
				[lift_fog]
					side=2,3,4
					x=0-21
					y=0-21
				[/lift_fog]
				{SCROLL_TO_SLOW 10 52}
				[delay]
					time=15
				[/delay]
				)}
				[delay]
					time=15
				[/delay]
				{RAND_CAP_VILLAGE (2,3,4) 7 7}
				{RAND_CAP_VILLAGE (2,3,4) 18 7}
				{RAND_CAP_VILLAGE (2,3,4) 18 9}
				{RAND_CAP_VILLAGE (2,3,4) 3 13}
				{RAND_CAP_VILLAGE (2,3,4) 3 15}
				{RAND_CAP_VILLAGE (2,3,4) 14 15}
				{LEADER_MESSAGE 2 "Careful about that ice."}
				[delay]
					time=31
				[/delay]
				{LEADER_MESSAGE 4 "Not many villages in the Ethereal District."}
				{VARIABLE_OP phase add 1}
				{RESET_WAVES}
			)}
			{LEADER_MESSAGE 3 "We're almost out of places to run to."}
		)}
		{DEFAULT_SPAWN 7 21 "Second Watch" (
				[lua]
					code = <<
						pickcreature("7", "Gryphon Rider,Drake Glider, Vampire Bat,Ghost,Falcon", "Gryphon Master,Sky Drake,Blood Bat,Wraith,Falcon", "Gryphon Master,Hurricane Drake,Dread Bat,Spectre,Elder Falcon", "", "", "", "", "", "landunit")
					>>
				[/lua]
			) (
				[lua]
					code = <<
						pickcreature("7", "Gryphon Rider,Drake Glider, Vampire Bat,Ghost,Falcon", "Gryphon Master,Sky Drake,Blood Bat,Wraith,Falcon", "Gryphon Master,Hurricane Drake,Dread Bat,Spectre,Elder Falcon", "", "", "", "", "", "waterunit")
					>>
				[/lua]
			) (
			[terrain]
				[and]
					y=1
				[/and]
				layer=overlay
				terrain="^Vov"
			[/terrain]
			{LEADER_MESSAGE 2 "We can't run any farther. If the northern Ethereal District DC is breached we'll be trapped between them."}
		) (
			{LEADER_MESSAGE 4 "That's the second to last."}
		)}
		{DEFAULT_SPAWN 8 01 "Dawn,Dusk" (
				[lua]
					code = <<
						pickcreature("8", "Heavy Infantryman,Dwarvish Ulfserker, Young Ogre,Wolf,Giant Rat", "Shock Trooper,Dwarvish Berserker,Ogre,Great Wolf,Giant Mudcrawler", "Iron Mauler,Dwarvish Berserker,Dire Wolf,Giant Spider", "", "", "", "", "Yeti", "landunit")
					>>
				[/lua]
			) (
				[lua]
					code = <<
						pickcreature("8", "Heavy Infantryman,Dwarvish Ulfserker, Young Ogre,Wolf,Giant Rat", "Shock Trooper,Dwarvish Berserker,Ogre,Great Wolf,Giant Mudcrawler", "Iron Mauler,Dwarvish Berserker,Dire Wolf,Giant Spider", "", "", "", "", "Yeti", "waterunit")
					>>
				[/lua]
			) (
			{LEADER_MESSAGE 3 "One more day before we are wholly surrounded."}
		) (
			{LEADER_MESSAGE 4 "Every single DC has been breached. We won't last long now."}
		)}
	[/event]
	
	[event]
		name=start
		[remove_shroud]
			side=2,3,4
			x=0-21
			y=132-162
		[/remove_shroud]
		[lift_fog]
			side=2,3,4
			x=0-21
			y=132-162
		[/lift_fog]
		[lock_view]
		[/lock_view]
		{LEADER_MESSAGE 3 "Argh. Stupid machine."}
		{LEADER_MESSAGE 3 "Is your communication to the Outside working?"}
		{LEADER_MESSAGE 2 "Nothing but static. We've never had any trouble with it before."}
		{LEADER_MESSAGE 4 "Sir! Look at the southern DC!"}
		{VARIABLE_OP phase add 1}
		{VARIABLE_OP wave[0].wave value 0}
		{SCROLL_TO_SLOW 10 165}
		{THUNDER (
			[delay]
				time=500
			[/delay]
			{VARIABLE_PHASE_LINESPAWN 161 (
				[lua]
					code = <<
						pickcreature("0", "Spearman,Bowman,Fencer,Heavy Infantryman,Cavalryman,Horseman,Mage", "Swordsman,Pikeman,Javelineer,Longbowman,Duelist,Shock Trooper,Dragoon,Knight,Lancer,White Mage,Red Mage", "Royal Guard,Halberdier,Master Bowman,Master at Arms,Iron Mauler,Cavalier,Grand Knight,Paladin,Mage of Light,Arch Mage,Silver Mage", "Sergeant", "Lieutenant", "General", "Grand Marshal", "Great Mage,Grand Marshal,Lancer,Javelineer", "landunit")
					>>
				[/lua]
			) (
				[lua]
					code = <<
						pickcreature("0","Merman Fighter,Merman Fighter,Merman Hunter,Mermaid Initiate", "Merman Warrior,Merman Warrior,Merman Warrior,Merman Warrior,Merman Spearman,Merman Netcaster,Mermaid Enchantress,Mermaid Priestess", "Merman Triton,Merman Triton,Merman Triton,Merman Triton,Merman Triton,Merman Hoplite,Merman Hoplite,Merman Hoplite,Merman Javelineer,Merman Javelineer,Merman Entangler,Merman Entangler,Mermaid Siren,Mermaid Siren,Mermaid Diviner,Mermaid Diviner", "", "", "", "", "", "waterunit")
					>>
				[/lua]
			)}
			[delay]
				time=1000
			[/delay]
		)}
		{VARIABLE_OP wave[0].wave add 1}
		{LEADER_MESSAGE 2 "Holy! That's twenty breaches!"}
		{LEADER_MESSAGE 2 "We're barely going to be able to fight these guys off."}
		{LEADER_MESSAGE 2 "Do we know anything about why this is happening, or what's going to happen next?"}
		{LEADER_MESSAGE 3 "My agiyameter says that we'll see twenty more every dawn until we get this sorted out."}
		{LEADER_MESSAGE 3 "That's all."}
		{LEADER_MESSAGE 2 "..."}
		{LEADER_MESSAGE 2 "If they reach the northern DC and release the prisoners there, things will get out of hand."}
		{SCROLL_TO_SLOW 10 141}
		[delay]
			time=1000
		[/delay]
		{LEADER_MESSAGE 4 "As if they weren't already."}
		{LEADER_MESSAGE 3 "And they'll be able to open the gate to the Marsh District."}
		{LEADER_MESSAGE 2 "They'll manage to do that eventually no matter what, but the longer we can hold them at bay the better."}
		{LEADER_MESSAGE 2 "Just don't be tempted to make a last stand. We're a better asset alive then dead."}
		[unlock_view]
		[/unlock_view]
	[/event]

	[event]
		name=turn 2
				
		{AT_TIME "Dawn" no (
			{VARIABLE_PHASE_LINESPAWN 161 (
				[lua]
					code = <<
						pickcreature(0, "Spearman,Bowman,Fencer,Heavy Infantryman,Cavalryman,Horseman,Mage", "Swordsman,Pikeman,Javelineer,Longbowman,Duelist,Shock Trooper,Dragoon,Knight,Lancer,White Mage,Red Mage", "Royal Guard,Halberdier,Master Bowman,Master at Arms,Iron Mauler,Cavalier,Grand Knight,Paladin,Mage of Light,Arch Mage,Silver Mage", "Sergeant", "Lieutenant", "General", "Grand Marshal", "Great Mage,Grand Marshal,Lancer,Javelineer", "landunit")
					>>
				[/lua]
			) (
				[lua]
					code = <<
						pickcreature(0,"Merman Fighter,Merman Fighter,Merman Hunter,Mermaid Initiate", "Merman Warrior,Merman Warrior,Merman Warrior,Merman Warrior,Merman Spearman,Merman Netcaster,Mermaid Enchantress,Mermaid Priestess", "Merman Triton,Merman Triton,Merman Triton,Merman Triton,Merman Triton,Merman Hoplite,Merman Hoplite,Merman Hoplite,Merman Javelineer,Merman Javelineer,Merman Entangler,Merman Entangler,Mermaid Siren,Mermaid Siren,Mermaid Diviner,Mermaid Diviner", "", "", "", "", "", "waterunit")
					>>
				[/lua]
			)}
			{VARIABLE_OP wave[0].wave add 1}
		)}
	[/event]

	[event]
		name=turn 80
		{LEADER_MESSAGE 3 "The static is lessening!"}
		{LEADER_MESSAGE 3 "But I can't hear anything yet."}
	[/event]

	[event]
		name=turn 90
		{LEADER_MESSAGE 3 "Anybody? This is CDPP! Code spiky porpoise! Do you copy?"}
		{LEADER_MESSAGE 3 "I'm getting a signal, but not a reply."}
	[/event]
	[event]
		name=turn 91
		{LEADER_MESSAGE 1 "This is PP High Command. Please repeat your message."}
		{LEADER_MESSAGE 3 "Spiky Porpoise."}
		{LEADER_MESSAGE 3 "Spiky Porpoise!"}
		{LEADER_MESSAGE 1 "Spiky Porpoise understood. Please stand by."}
		{LEADER_MESSAGE 3 "Hello? Hello?"}
		{LEADER_MESSAGE 3 "He's gone."}
	[/event]
	[event]
		name=turn 94
		{LEADER_MESSAGE 1 "The Detention Center Refastening Procedure will be completed one day from now."}
		{LEADER_MESSAGE 3 "One day? We have hope!"}
		{LEADER_MESSAGE 2 "Not much. We still have to defeat all the escaped enemies."}
		{LEADER_MESSAGE 1 "From that time forth, you will be unable to recruit."}
		{LEADER_MESSAGE 4 "Not getting a break, are we."}
	[/event]

	[event]
		name=turn 100
		[set_recruit]
			side=2
			recruit=
		[/set_recruit]
		[set_recruit]
			side=3
			recruit=
		[/set_recruit]
		[set_recruit]
			side=4
			recruit=
		[/set_recruit]
		[event]
			name=die
			first_time_only=no
			[filter]
				side=1
			[/filter]
			[if]
				[not]
					[have_unit]
						side=1
						canrecruit=no
					[/have_unit]
				[/not]
				[then]
					[endlevel]
						result=victory
					[/endlevel]
				[/then]
			[/if]
		[/event]
	[/event]

	[event]
		name=victory
	[/event]

	[event]
		name=die
		first_time_only=no
		[filter]
			canrecruit=yes
		[/filter]
	[/event]

	[event]
		name=side turn
		first_time_only=no
		[store_time_of_day]
		[/store_time_of_day]
		[if]
			[variable]
				name=time_of_day.name
				equals="First Watch", "Second Watch"
			[/variable]
			[then]
				{FREEZE_ADJACENT}
			[/then]
		[/if]
	[/event]
	{UNFREEZE_ON_MOVEMENT}
[/multiplayer]
